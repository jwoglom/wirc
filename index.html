<!doctype html>
<html>
<head>
    <title>Wirc</title>
</head>
<link rel="stylesheet" type="text/css" href="core.css" />
<style>
h1 {
    font-size: 32px;
}
.channel, .welcome {
    display: none;
}
</style>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    uid = null;
    last = 0;
    channel = null;
    init = function() {
        $(".welcome").show();
        $("#nick").val("wirc_"+(Math.floor(Math.random()*1000)));
    }
    connectsmt = function() {
        var j = {
            m: "conn",
            server: $("#server").val(),
            port: $("#port").val(),
            nick: $("#nick").val(),
            realname: $("#realname").val(),
            chan: $("#chan").val()
        }
        $.post("req.php", j, function(d) {
            console.log(d);
            uid = d;
            channel = j['chan'];
            setup();
            ping();
        });
    }
    send = function(msg) {
        $.post("req.php", {m: "send", uid: uid, msg: msg}, function(d) {
            console.log("Sent: "+d);
        });
    }
    setup = function() {
        $(".welcome").hide();
        $(".channel").show();
        setInterval(ping, 500);
    }

    ping = function() {
        $.post("req.php", {m: "ping", "uid": uid, last: last}, function(d) {
            console.log(d);
            last += d.length;
            upd(d);

        });
    }
    upd = function(c) {
        $("#messages").append(c);
        var c = $('#messages');
        c.scrollTop(
            c[0].scrollHeight - c.height()
        );
    }
    sendmsg = function() {
        send("PRIVMSG "+channel+" "+($("#text").val()));
    }
    init();
});

</script>
<body>
<div class="welcome">
<h1>Welcome to Wirc</h1>
Server: <input id="server" value="irc.bouncerstation.com" /><br />
Port: <input id="port" value=6667 /><br />
Nick: <input id="nick" value="wirc" /><br />
Realname: <input id="realname" value="AngelaWilliam" /><br />
Channel: <input id="chan" value="#telneta" /><br />
<button onclick="connectsmt()">Connect</button>
</div>
<div class="channel" style="padding: 30px">
    <table>
    <tr><td>
        <textarea id="messages" style="width: 500px;height: 500px"></textarea>
    </td></tr>
    <tr><td>
        <input id="text" style="width: 450px" />
        <button onclick="sendmsg()" style="width: 50px;padding:5px">Send</button>
    </td></tr></table>
</div>
</body>
</html>